# Got from ChatGPT
name: Java CI/CD

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Set up JDK
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      # 3. Compile Java sources
      - name: Compile Java files
        run: |
          mkdir -p out
          javac -d out $(find src -name "*.java")
      
      # 4. Run Checkstyle
      - name: Run Checkstyle
        run: |
          java -jar checkstyle-12.1.1-all.jar -c checkstyle.xml src/ > checkstyle-report.txt || true
          cat checkstyle-report.txt
          if grep -q '\[ERROR\]' checkstyle-report.txt; then
            echo "‚ùå Checkstyle violations found!"
            exit 1
          fi

      # 5. Run Unit Test (HelloWorldTest.java)
      - name: Run HelloWorldTest
        run: |
          java -cp out test.HelloWorldTest

      # 6. Run Bash Script (count words, lines, and bytes in a file)
      - name: Count in file
        run: |
          bash -c 'wc src/HelloWorld.java'
